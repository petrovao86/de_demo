# Docker
[Инструкция по установке docker](https://docs.docker.com/get-started/get-docker/)

Запуск проекта:
```shell
docker compose -f ./docker/docker-compose.yml -p de_demo up --build -d
```
> На первый запуск может понадобиться некоторое время, последующие запуски будут существенно 
> быстрее благодаря использованию кэширующих слоёв.

Остановка и очистка
```shell
docker compose -f ./docker/docker-compose.yml -p de_demo down --volumes
```

## Dockerfile
Весь проект упакован в один [Dockerfile](de-demo.dockerfile).

Файл разделён на несколько слоёв.
### builder
Базовый слой отвечающий за сборку проекта, содержит в себе установленный `poetry`, 
пересобирается редко при глобальных изменениях проекта.

### cache
Слой кэширующий зависимости проекта. Пересобирается при изменении зависимостей проекта.

### build
Слой отвечает за сборку пакета. Пересобирается при изменении кода в [de_demo](..\de_demo) 
или зависимостей проекта.

### base
Основной слой образа. Использует дитрибутив и зависимости из `build`.

### app
Слой отвечающий за сборку образа утилит командной строки `de-demo-app`. 
В нём устанавливается базовый пакет de_demo.

### api
Слой отвечающий за сборку образа api `de-demo-api`.
В нём устанавливается пакет de_demo[api] содержащий дополнительные возможности api.

### dagster
Слой отвечающий за сборку образа dagster `de-demo-dagster`. 
Содержит пакет de_demo[dagster,dbt] c dagster  и dbt.
Пересобирается при изменении dbt проекта.
